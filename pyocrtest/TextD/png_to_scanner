import pytesseract
from PIL import Image
import os
import re

def clean_product_name(product_name):
    # Remove unwanted patterns
    product_name = re.sub(r'\s*a\s*', '', product_name)
    product_name = re.sub(r'\s*w1\s*', '', product_name)
    product_name = re.sub(r'\s*bal\s*', '', product_name)
    return product_name

def extract_product_and_price(text):
    pattern = re.compile(r'(.+)\*\s*([0-9,.]+)')
    matches = pattern.findall(text)
    return matches

def ocr_image(image_path):
    # Open the image file
    image = Image.open(image_path)

    # Perform OCR using Tesseract
    text = pytesseract.image_to_string(image)

    # Extract product and price
    matches = extract_product_and_price(text)
    
    # Create a list to store the products and prices
    products_and_prices = []

    for match in matches:
        # Clean the product name
        product_name = clean_product_name(match[0])

        # Create a dictionary for the product and price
        product_and_price = {"Product": product_name, "Price": match[1]}
        
        # Add the dictionary to the list
        products_and_prices.append(product_and_price)

    # Return the list of products and prices
    return products_and_prices

# Replace 'image_path' with the path to your image file
products_and_prices = ocr_image('/Users/pc/Documents/GitHub/OCR/pyocrtest/photo/img1.jpeg')

# Print the list of products and prices
for product_and_price in products_and_prices:
    print(product_and_price)
    
# def process_directory(directory):
#     # Iterate over all files in the directory
#     for filename in os.listdir(directory):
#         # Check if the file is an image
#         if filename.endswith(".png") or filename.endswith(".jpg"):
#             # Construct the full path to the image file
#             image_path = os.path.join(directory, filename)

#             # Perform OCR on the image
#             ocr_image(image_path)

# # Replace 'directory_path' with the path to your directory containing the images
# # process_directory('path/to/your/directory')